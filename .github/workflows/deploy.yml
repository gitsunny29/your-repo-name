name: Build and Deploy to IIS

on:
  push:
    branches: [main]  # or use 'master' or 'develop'

jobs:
  build-and-deploy:
    runs-on: self-hosted

    steps:
    - name: â¬‡ Checkout code
      uses: actions/checkout@v3

    - name: ğŸ”§ Restore dependencies
      run: dotnet restore

    - name: ğŸ› ï¸ Build the project
      run: dotnet build --configuration Release

    - name: ğŸ“¦ Publish the project
      run: dotnet publish -c Release -o ./publish

    - name: ğŸš€ Deploy to IIS
      shell: powershell
      run: |
        Import-Module WebAdministration
        Stop-WebSite -Name "MyWebApp"
        Remove-Item "C:\inetpub\wwwroot\MyWebApp\*" -Recurse -Force
        Copy-Item ".\publish\*" "C:\inetpub\wwwroot\MyWebApp\" -Recurse -Force
        Start-WebSite -Name "MyWebApp"
