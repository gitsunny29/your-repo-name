name: Build and Deploy to IIS

on:
  push:
    branches: [main]

jobs:
  build-and-deploy:
    runs-on: self-hosted

    steps:
    - name: â¬‡ Checkout code
      uses: actions/checkout@v3

    - name: ğŸ”§ Restore dependencies
      run: dotnet restore MyWebApp.sln  # ğŸ‘ˆ or path to .csproj if no .sln

    - name: ğŸ› ï¸ Build the project
      run: dotnet build MyWebApp.sln --configuration Release --no-restore

    - name: ğŸ“¦ Publish the project
      run: dotnet publish MyWebApp/MyWebApp.csproj -c Release -o ./publish --no-build

    - name: ğŸš€ Deploy to IIS
      shell: powershell
      run: |
        Import-Module WebAdministration
        Stop-WebSite -Name "MyWebApp"
        Remove-Item "C:\inetpub\wwwroot\MyWebApp\*" -Recurse -Force
        Copy-Item ".\publish\*" "C:\inetpub\wwwroot\MyWebApp\" -Recurse -Force
        Start-WebSite -Name "MyWebApp"
