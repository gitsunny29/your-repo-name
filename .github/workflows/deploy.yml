name: Build and Deploy to IIS

on:
  push:
    branches: [main]

jobs:
  build-and-deploy:
    runs-on: self-hosted

    steps:
    - name: ‚¨á Checkout code
      uses: actions/checkout@v3

    - name: üîß Restore dependencies
      run: dotnet restore MyWebApp/MyWebApp.csproj

    - name: üõ†Ô∏è Build the project
      run: dotnet build MyWebApp/MyWebApp.csproj --configuration Release --no-restore

    - name: üì¶ Publish the project
      run: dotnet publish MyWebApp/MyWebApp.csproj --configuration Release --output ./publish --no-build

    - name: üöÄ Deploy to IIS
      shell: powershell
      run: |
        Import-Module WebAdministration
        Stop-WebSite -Name "MyWebApp"
        Remove-Item "C:\inetpub\wwwroot\MyWebApp\*" -Recurse -Force -ErrorAction SilentlyContinue
        Copy-Item ".\publish\*" "C:\inetpub\wwwroot\MyWebApp\" -Recurse -Force
        Start-WebSite -Name "MyWebApp"

